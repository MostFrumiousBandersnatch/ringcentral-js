!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("pubnub"),require("es6-promise"),require("fetch-ponyfill")):"function"==typeof define&&define.amd?define(["pubnub","es6-promise","fetch-ponyfill"],factory):(global.RingCentral=global.RingCentral||{},global.RingCentral.SDK=factory(global["disabled-PubNub"],global["disabled-Promise"],global["disabled-fetch"]))}(this,function(pubnub,es6Promise,fetchPonyfill){"use strict";function toObject(val){if(null===val||void 0===val)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(val)}function Cache(options){this._prefix=options.prefix||Cache.defaultPrefix,this._externals=options.externals}function isObjectObject(o){return!0===isobject(o)&&"[object Object]"===Object.prototype.toString.call(o)}function EventHandlers(){}function EventEmitter$1(){EventEmitter$1.init.call(this)}function $getMaxListeners(that){return void 0===that._maxListeners?EventEmitter$1.defaultMaxListeners:that._maxListeners}function emitNone(handler,isFn,self){if(isFn)handler.call(self);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].call(self)}function emitOne(handler,isFn,self,arg1){if(isFn)handler.call(self,arg1);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].call(self,arg1)}function emitTwo(handler,isFn,self,arg1,arg2){if(isFn)handler.call(self,arg1,arg2);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].call(self,arg1,arg2)}function emitThree(handler,isFn,self,arg1,arg2,arg3){if(isFn)handler.call(self,arg1,arg2,arg3);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].call(self,arg1,arg2,arg3)}function emitMany(handler,isFn,self,args){if(isFn)handler.apply(self,args);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].apply(self,args)}function _addListener(target,type,listener,prepend){var m,events,existing;if("function"!=typeof listener)throw new TypeError('"listener" argument must be a function');if((events=target._events)?(events.newListener&&(target.emit("newListener",type,listener.listener?listener.listener:listener),events=target._events),existing=events[type]):(events=target._events=new EventHandlers,target._eventsCount=0),existing){if("function"==typeof existing?existing=events[type]=prepend?[listener,existing]:[existing,listener]:prepend?existing.unshift(listener):existing.push(listener),!existing.warned&&(m=$getMaxListeners(target))&&m>0&&existing.length>m){existing.warned=!0;var w=new Error("Possible EventEmitter memory leak detected. "+existing.length+" "+type+" listeners added. Use emitter.setMaxListeners() to increase limit");w.name="MaxListenersExceededWarning",w.emitter=target,w.type=type,w.count=existing.length,emitWarning(w)}}else existing=events[type]=listener,++target._eventsCount;return target}function emitWarning(e){"function"==typeof console.warn?console.warn(e):console.log(e)}function _onceWrap(target,type,listener){function g(){target.removeListener(type,g),fired||(fired=!0,listener.apply(target,arguments))}var fired=!1;return g.listener=listener,g}function listenerCount(type){var events=this._events;if(events){var evlistener=events[type];if("function"==typeof evlistener)return 1;if(evlistener)return evlistener.length}return 0}function spliceOne(list,index){for(var i=index,k=i+1,n=list.length;k<n;i+=1,k+=1)list[i]=list[k];list.pop()}function arrayClone(arr,i){for(var copy=new Array(i);i--;)copy[i]=arr[i];return copy}function unwrapListeners(arr){for(var ret=new Array(arr.length),i=0;i<ret.length;++i)ret[i]=arr[i].listener||arr[i];return ret}function ApiResponse(options){this._externals=options.externals,this._request=options.request,this._response=options.response,this._text=options.responseText||"",this._json=null,this._multipart=[]}function hasOwnProperty$1(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}function stringifyPrimitive(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}}function stringify(obj,sep,eq,name){return sep=sep||"&",eq=eq||"=",null===obj&&(obj=void 0),"object"==typeof obj?map(objectKeys(obj),function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;return isArray(obj[k])?map(obj[k],function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep):ks+encodeURIComponent(stringifyPrimitive(obj[k]))}).join(sep):name?encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj)):""}function map(xs,f){if(xs.map)return xs.map(f);for(var res=[],i=0;i<xs.length;i++)res.push(f(xs[i],i));return res}function parse(qs,sep,eq,options){sep=sep||"&",eq=eq||"=";var obj={};if("string"!=typeof qs||0===qs.length)return obj;var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;options&&"number"==typeof options.maxKeys&&(maxKeys=options.maxKeys);var len=qs.length;maxKeys>0&&len>maxKeys&&(len=maxKeys);for(var i=0;i<len;++i){var kstr,vstr,k,v,x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq);idx>=0?(kstr=x.substr(0,idx),vstr=x.substr(idx+1)):(kstr=x,vstr=""),k=decodeURIComponent(kstr),v=decodeURIComponent(vstr),hasOwnProperty$1(obj,k)?isArray(obj[k])?obj[k].push(v):obj[k]=[obj[k],v]:obj[k]=v}return obj}function findHeaderName(name,headers){return name=name.toLowerCase(),Object.keys(headers).reduce(function(res,key){return res||(name==key.toLowerCase()?key:res)},null)}function Client(externals){EventEmitter.call(this),this._externals=externals,this.events={beforeRequest:"beforeRequest",requestSuccess:"requestSuccess",requestError:"requestError"}}function Auth(options){this._cache=options.cache,this._cacheId=options.cacheId,this._refreshHandicapMs=options.refreshHandicapMs||6e4}function Platform(options){EventEmitter$3.call(this),this.events={beforeLogin:"beforeLogin",loginSuccess:"loginSuccess",loginError:"loginError",beforeRefresh:"beforeRefresh",refreshSuccess:"refreshSuccess",refreshError:"refreshError",beforeLogout:"beforeLogout",logoutSuccess:"logoutSuccess",logoutError:"logoutError",rateLimitError:"rateLimitError"},options=options||{},this._server=options.server,this._appKey=options.appKey,this._appSecret=options.appSecret,this._redirectUri=options.redirectUri||"",this._refreshDelayMs=options.refreshDelayMs||100,this._clearCacheOnRefreshError=void 0===options.clearCacheOnRefreshError||options.clearCacheOnRefreshError,this._userAgent=(options.appName?options.appName+(options.appVersion?"/"+options.appVersion:"")+" ":"")+"RCJSSDK/"+Constants.version,this._externals=options.externals,this._cache=options.cache,this._client=options.client,this._refreshPromise=null,this._auth=new Auth_1({cache:this._cache,cacheId:Platform._cacheId,refreshHandicapMs:options.refreshHandicapMs})}function buildIEFriendlyString(match,$1,$2){return $1+":"+($2||"00")}function parseISOString(time){return"string"==typeof(time=time||0)?Date.parse(time.replace(ISO_REG_EXP,buildIEFriendlyString)):time}function Subscription(options){EventEmitter$4.call(this),options=options||{},this.events={notification:"notification",removeSuccess:"removeSuccess",removeError:"removeError",renewSuccess:"renewSuccess",renewError:"renewError",subscribeSuccess:"subscribeSuccess",subscribeError:"subscribeError",automaticRenewSuccess:"automaticRenewSuccess",automaticRenewError:"automaticRenewError"},this._externals=options.externals,this._platform=options.platform,this._pollInterval=options.pollInterval||1e4,this._renewHandicapMs=options.renewHandicapMs||12e4,this._pubnub=null,this._pubnubLastChannel=null,this._pubnubLastSubscribeKey=null,this._timeout=null,this._subscription=null}function CachedSubscription(options){if(!(options=options||{}).cacheKey)throw new Error("Cached Subscription requires cacheKey parameter to be defined");this._cacheKey=options.cacheKey,Subscription_1.call(this,options),this._cache=options.cache,this._subscription=void 0}function SDK(options){this._externals=new Externals_1(options),this._cache=new Cache_1({externals:this._externals,prefix:options.cachePrefix}),this._client=new Client_1(this._externals),this._platform=new Platform_1(objectAssign({},options,{externals:this._externals,client:this._client,cache:this._cache}))}pubnub=pubnub&&pubnub.hasOwnProperty("default")?pubnub.default:pubnub,es6Promise=es6Promise&&es6Promise.hasOwnProperty("default")?es6Promise.default:es6Promise,fetchPonyfill=fetchPonyfill&&fetchPonyfill.hasOwnProperty("default")?fetchPonyfill.default:fetchPonyfill;var getOwnPropertySymbols=Object.getOwnPropertySymbols,hasOwnProperty=Object.prototype.hasOwnProperty,propIsEnumerable=Object.prototype.propertyIsEnumerable,objectAssign=function(){try{if(!Object.assign)return!1;var test1=new String("abc");if(test1[5]="de","5"===Object.getOwnPropertyNames(test1)[0])return!1;for(var test2={},i=0;i<10;i++)test2["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(test2).map(function(n){return test2[n]}).join(""))return!1;var test3={};return"abcdefghijklmnopqrst".split("").forEach(function(letter){test3[letter]=letter}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},test3)).join("")}catch(err){return!1}}()?Object.assign:function(target,source){for(var from,symbols,to=toObject(target),s=1;s<arguments.length;s++){from=Object(arguments[s]);for(var key in from)hasOwnProperty.call(from,key)&&(to[key]=from[key]);if(getOwnPropertySymbols){symbols=getOwnPropertySymbols(from);for(var i=0;i<symbols.length;i++)propIsEnumerable.call(from,symbols[i])&&(to[symbols[i]]=from[symbols[i]])}}return to};Cache.defaultPrefix="rc-",Cache.prototype.setItem=function(key,data){return this._externals.localStorage[this._prefixKey(key)]=JSON.stringify(data),this},Cache.prototype.removeItem=function(key){return delete this._externals.localStorage[this._prefixKey(key)],this},Cache.prototype.getItem=function(key){var item=this._externals.localStorage[this._prefixKey(key)];return item?JSON.parse(item):null},Cache.prototype.clean=function(){for(var key in this._externals.localStorage)this._externals.localStorage.hasOwnProperty(key)&&0===key.indexOf(this._prefix)&&delete this._externals.localStorage[key];return this},Cache.prototype._prefixKey=function(key){return this._prefix+key};var Cache_1=Cache,isobject=function(val){return null!=val&&"object"==typeof val&&!1===Array.isArray(val)},isPlainObject=function(o){var ctor,prot;return!1!==isObjectObject(o)&&("function"==typeof(ctor=o.constructor)&&(prot=ctor.prototype,!1!==isObjectObject(prot)&&!1!==prot.hasOwnProperty("isPrototypeOf")))};EventHandlers.prototype=Object.create(null),EventEmitter$1.EventEmitter=EventEmitter$1,EventEmitter$1.usingDomains=!1,EventEmitter$1.prototype.domain=void 0,EventEmitter$1.prototype._events=void 0,EventEmitter$1.prototype._maxListeners=void 0,EventEmitter$1.defaultMaxListeners=10,EventEmitter$1.init=function(){this.domain=null,EventEmitter$1.usingDomains&&(!(void 0).active||this instanceof(void 0).Domain||(this.domain=(void 0).active)),this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new EventHandlers,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},EventEmitter$1.prototype.setMaxListeners=function(n){if("number"!=typeof n||n<0||isNaN(n))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=n,this},EventEmitter$1.prototype.getMaxListeners=function(){return $getMaxListeners(this)},EventEmitter$1.prototype.emit=function(type){var er,handler,len,args,i,events,domain,doError="error"===type;if(events=this._events)doError=doError&&null==events.error;else if(!doError)return!1;if(domain=this.domain,doError){if(er=arguments[1],!domain){if(er instanceof Error)throw er;var err=new Error('Uncaught, unspecified "error" event. ('+er+")");throw err.context=er,err}return er||(er=new Error('Uncaught, unspecified "error" event')),er.domainEmitter=this,er.domain=domain,er.domainThrown=!1,domain.emit("error",er),!1}if(!(handler=events[type]))return!1;var isFn="function"==typeof handler;switch(len=arguments.length){case 1:emitNone(handler,isFn,this);break;case 2:emitOne(handler,isFn,this,arguments[1]);break;case 3:emitTwo(handler,isFn,this,arguments[1],arguments[2]);break;case 4:emitThree(handler,isFn,this,arguments[1],arguments[2],arguments[3]);break;default:for(args=new Array(len-1),i=1;i<len;i++)args[i-1]=arguments[i];emitMany(handler,isFn,this,args)}return!0},EventEmitter$1.prototype.addListener=function(type,listener){return _addListener(this,type,listener,!1)},EventEmitter$1.prototype.on=EventEmitter$1.prototype.addListener,EventEmitter$1.prototype.prependListener=function(type,listener){return _addListener(this,type,listener,!0)},EventEmitter$1.prototype.once=function(type,listener){if("function"!=typeof listener)throw new TypeError('"listener" argument must be a function');return this.on(type,_onceWrap(this,type,listener)),this},EventEmitter$1.prototype.prependOnceListener=function(type,listener){if("function"!=typeof listener)throw new TypeError('"listener" argument must be a function');return this.prependListener(type,_onceWrap(this,type,listener)),this},EventEmitter$1.prototype.removeListener=function(type,listener){var list,events,position,i,originalListener;if("function"!=typeof listener)throw new TypeError('"listener" argument must be a function');if(!(events=this._events))return this;if(!(list=events[type]))return this;if(list===listener||list.listener&&list.listener===listener)0==--this._eventsCount?this._events=new EventHandlers:(delete events[type],events.removeListener&&this.emit("removeListener",type,list.listener||listener));else if("function"!=typeof list){for(position=-1,i=list.length;i-- >0;)if(list[i]===listener||list[i].listener&&list[i].listener===listener){originalListener=list[i].listener,position=i;break}if(position<0)return this;if(1===list.length){if(list[0]=void 0,0==--this._eventsCount)return this._events=new EventHandlers,this;delete events[type]}else spliceOne(list,position);events.removeListener&&this.emit("removeListener",type,originalListener||listener)}return this},EventEmitter$1.prototype.removeAllListeners=function(type){var listeners,events;if(!(events=this._events))return this;if(!events.removeListener)return 0===arguments.length?(this._events=new EventHandlers,this._eventsCount=0):events[type]&&(0==--this._eventsCount?this._events=new EventHandlers:delete events[type]),this;if(0===arguments.length){for(var key,keys=Object.keys(events),i=0;i<keys.length;++i)"removeListener"!==(key=keys[i])&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events=new EventHandlers,this._eventsCount=0,this}if("function"==typeof(listeners=events[type]))this.removeListener(type,listeners);else if(listeners)do{this.removeListener(type,listeners[listeners.length-1])}while(listeners[0]);return this},EventEmitter$1.prototype.listeners=function(type){var evlistener,events=this._events;return events&&(evlistener=events[type])?"function"==typeof evlistener?[evlistener.listener||evlistener]:unwrapListeners(evlistener):[]},EventEmitter$1.listenerCount=function(emitter,type){return"function"==typeof emitter.listenerCount?emitter.listenerCount(type):listenerCount.call(emitter,type)},EventEmitter$1.prototype.listenerCount=listenerCount,EventEmitter$1.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var events=Object.freeze({default:EventEmitter$1,EventEmitter:EventEmitter$1});ApiResponse._contentType="Content-Type",ApiResponse._jsonContentType="application/json",ApiResponse._multipartContentType="multipart/mixed",ApiResponse._urlencodedContentType="application/x-www-form-urlencoded",ApiResponse._headerSeparator=":",ApiResponse._bodySeparator="\n\n",ApiResponse._boundarySeparator="--",ApiResponse._unauthorizedStatus=401,ApiResponse._rateLimitStatus=429,ApiResponse.prototype.receiveResponse=function(response){return this._response=response,new this._externals.Promise(function(resolve){return resolve(this._isMultipart()||this._isJson()?this.response().text():"")}.bind(this)).then(function(text){return this._text=text,text}.bind(this))},ApiResponse.prototype.response=function(){return this._response},ApiResponse.prototype.request=function(){return this._request},ApiResponse.prototype.ok=function(){return this._response&&this._response.ok},ApiResponse.prototype.text=function(){if(!this._isJson()&&!this._isMultipart())throw new Error("Response is not text");return this._text},ApiResponse.prototype.json=function(){if(!this._isJson())throw new Error("Response is not JSON");return this._json||(this._json=this._text?JSON.parse(this._text):null),this._json},ApiResponse.prototype.error=function(skipOKCheck){if(this.ok()&&!skipOKCheck)return null;var message=(this._response&&this._response.status?this._response.status+" ":"")+(this._response&&this._response.statusText?this._response.statusText:"");try{this.json().message&&(message=this.json().message),this.json().error_description&&(message=this.json().error_description),this.json().description&&(message=this.json().description)}catch(e){}return message},ApiResponse.prototype.toMultipart=function(){return this._isMultipart()?this.multipart():[this]},ApiResponse.prototype.multipart=function(){if(!this._isMultipart())throw new Error("Response is not multipart");if(!this._multipart.length){var text=this.text();if(!text)throw new Error("No response body");var boundary;try{boundary=this._getContentType().match(/boundary=([^;]+)/i)[1]}catch(e){throw new Error("Cannot find boundary")}if(!boundary)throw new Error("Cannot find boundary");var parts=text.toString().split(ApiResponse._boundarySeparator+boundary);if(""===parts[0].trim()&&parts.shift(),parts[parts.length-1].trim()==ApiResponse._boundarySeparator&&parts.pop(),parts.length<1)throw new Error("No parts in body");var statusInfo=this._create(parts.shift(),this._response.status,this._response.statusText).json();this._multipart=parts.map(function(part,i){var status=statusInfo.response[i].status;return this._create(part,status)}.bind(this))}return this._multipart},ApiResponse.prototype._isContentType=function(contentType){return this._getContentType().indexOf(contentType)>-1},ApiResponse.prototype._getContentType=function(){return this._response.headers.get(ApiResponse._contentType)||""},ApiResponse.prototype._isMultipart=function(){return this._isContentType(ApiResponse._multipartContentType)},ApiResponse.prototype._isJson=function(){return this._isContentType(ApiResponse._jsonContentType)},ApiResponse.prototype._create=function(text,status,statusText){text=text||"",status=status||200,statusText=statusText||"OK",text=text.replace(/\r/g,"");var headers=new this._externals.Headers,headersAndBody=text.split(ApiResponse._bodySeparator),headersText=headersAndBody.length>1?headersAndBody.shift():"";text=headersAndBody.length>0?headersAndBody.join(ApiResponse._bodySeparator):null,(headersText||"").split("\n").forEach(function(header){var split=header.trim().split(ApiResponse._headerSeparator),key=split.shift().trim(),value=split.join(ApiResponse._headerSeparator).trim();key&&headers.append(key,value)});var response=new this._externals.Response(text,{headers:headers,status:status,statusText:statusText});return new ApiResponse({externals:this._externals,request:null,response:response,responseText:text})};var ApiResponse_1=ApiResponse,isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)},objectKeys=Object.keys||function(obj){var res=[];for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&res.push(key);return res},qs={encode:stringify,stringify:stringify,decode:parse,parse:parse},qs$1=Object.freeze({stringify:stringify,parse:parse,default:qs,encode:stringify,decode:parse}),require$$0=events&&EventEmitter$1||events,qs$2=qs$1&&qs||qs$1,EventEmitter=require$$0.EventEmitter;Client._allowedMethods=["GET","POST","PUT","DELETE","PATCH","OPTIONS","HEAD"],(Client.prototype=Object.create(EventEmitter.prototype)).sendRequest=function(request){var apiResponse=new ApiResponse_1({externals:this._externals,request:request});return new this._externals.Promise(function(resolve){this.emit(this.events.beforeRequest,apiResponse),resolve(this._loadResponse(request))}.bind(this)).then(function(response){return apiResponse.receiveResponse(response)}).then(function(){if(!apiResponse.ok())throw new Error("Response has unsuccessful status");return this.emit(this.events.requestSuccess,apiResponse),apiResponse}.bind(this)).catch(function(e){throw e.apiResponse||(e=this.makeError(e,apiResponse)),this.emit(this.events.requestError,e),e}.bind(this))},Client.prototype._loadResponse=function(request){return this._externals.fetch.call(null,request)},Client.prototype.makeError=function(e,apiResponse){return e.hasOwnProperty("apiResponse")||e.hasOwnProperty("originalMessage")||(e.apiResponse=apiResponse,e.originalMessage=e.message,e.message=apiResponse&&apiResponse.error(!0)||e.originalMessage),e},Client.prototype.createRequest=function(init){if(init=init||{},init.headers=init.headers||{},!init.url)throw new Error("Url is not defined");if(init.method||(init.method="GET"),init.method=init.method.toUpperCase(),init.method&&Client._allowedMethods.indexOf(init.method)<0)throw new Error("Method has wrong value: "+init.method);if(init.credentials=init.credentials||"include",init.mode=init.mode||"cors",init.query&&(init.url=init.url+(init.url.indexOf("?")>-1?"&":"?")+qs$2.stringify(init.query)),findHeaderName("Accept",init.headers)||(init.headers.Accept=ApiResponse_1._jsonContentType),isPlainObject(init.body)||!init.body){var contentTypeHeaderName=findHeaderName(ApiResponse_1._contentType,init.headers);contentTypeHeaderName||(contentTypeHeaderName=ApiResponse_1._contentType,init.headers[contentTypeHeaderName]=ApiResponse_1._jsonContentType);var contentType=init.headers[contentTypeHeaderName];contentType.indexOf(ApiResponse_1._jsonContentType)>-1?"GET"!==init.method&&"HEAD"!==init.method||!init.body?init.body=JSON.stringify(init.body):init.body=void 0:contentType.indexOf(ApiResponse_1._urlencodedContentType)>-1&&(init.body=qs$2.stringify(init.body))}var req=new this._externals.Request(init.url,init);return req.originalBody=init.body,req};var Client_1=Client,commonjsGlobal="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},root="undefined"!=typeof window&&window||void 0!==commonjsGlobal&&commonjsGlobal||function(){return this}(),Externals_1=function(options){options=options||{},this.PubNub=options.PubNub||root.PubNub||pubnub,this.localStorage=options.localStorage||(void 0!==root.localStorage?root.localStorage:{}),this.Promise=options.Promise||root.Promise||es6Promise&&es6Promise.Promise;var fetchPonyfill$$1=fetchPonyfill?fetchPonyfill({Promise:this.Promise}):{};if(this.fetch=options.fetch||root.fetch||fetchPonyfill$$1.fetch,this.Request=options.Request||root.Request||fetchPonyfill$$1.Request,this.Response=options.Response||root.Response||fetchPonyfill$$1.Response,this.Headers=options.Headers||root.Headers||fetchPonyfill$$1.Headers,!(this.fetch&&this.Response&&this.Request&&this.Headers))throw new Error("Fetch API is missing");if(!this.Promise)throw new Error("Promise is missing");if(!this.localStorage)throw new Error("LocalStorage is missing");if(!this.PubNub)throw new Error("PubNub is missing")};Auth.prototype.accessToken=function(){return this.data().access_token},Auth.prototype.refreshToken=function(){return this.data().refresh_token},Auth.prototype.tokenType=function(){return this.data().token_type},Auth.prototype.data=function(){return this._cache.getItem(this._cacheId)||{token_type:"",access_token:"",expires_in:0,refresh_token:"",refresh_token_expires_in:0}},Auth.prototype.setData=function(newData){newData=newData||{};var data=this.data();return Object.keys(newData).forEach(function(key){data[key]=newData[key]}),data.expire_time=Date.now()+1e3*data.expires_in,data.refresh_token_expire_time=Date.now()+1e3*data.refresh_token_expires_in,this._cache.setItem(this._cacheId,data),this},Auth.prototype.accessTokenValid=function(){return this.data().expire_time-this._refreshHandicapMs>Date.now()},Auth.prototype.refreshTokenValid=function(){return this.data().refresh_token_expire_time>Date.now()},Auth.prototype.cancelAccessToken=function(){return this.setData({access_token:"",expires_in:0})};var Auth_1=Auth,scripts={clean:"rm -rf build/*",uglify:"uglifyjs --compress --output build/ringcentral.min.js  --source-map 'filename=build/ringcentral.js.map' build/ringcentral.js",rollup:"rollup -c rollup.config.js",build:"npm run clean && npm run rollup && npm run uglify",watch:"npm run rollup -- --watch",test:"npm run hint && npm run build && npm run istanbul && npm run karma && npm run karma-webpack",mocha:"mocha --opts mocha.opts","mocha-watch":"npm run mocha -- --watch","mocha-api":"mocha ./test-api/**/*-spec.js",karma:"karma start karma.conf.js","karma-watch":"npm run karma -- --no-single-run --auto-watch","karma-webpack":"karma start karma.conf.webpack.js","karma-webpack-watch":"npm run karma-webpack -- --no-single-run --auto-watch",istanbul:"istanbul cover _mocha -- --opts mocha.opts",coveralls:"cat ./build/coverage/lcov.info | coveralls",start:"http-server -p 3030",docs:"jsdoc2md 'src/**/*!(test).js' > API.md",hint:"jshint src/**/*.js"},dependencies={"es6-promise":"^4.0.5","fetch-ponyfill":"^3.0.2","is-plain-object":"^2.0.1","object-assign":"^4.1.0",pubnub:"^4.4.2"},devDependencies={chai:"3.5.0",coveralls:"2.13.1","fetch-mock":"5.9.4","http-server":"0.9.0",istanbul:"0.4.5","jsdoc-to-markdown":"2.0.1",jshint:"2.9.4","json-loader":"0.5.4",karma:"1.4.1","karma-chai-plugins":"0.8.0","karma-chrome-launcher":"2.0.0","karma-coverage":"1.1.1","karma-firefox-launcher":"1.0.0","karma-html-reporter":"0.2.6","karma-mocha":"1.3.0","karma-mocha-reporter":"2.2.2","karma-phantomjs-launcher":"1.0.2","karma-sourcemap-loader":"0.3.5","karma-webpack":"2.0.2",mocha:"3.2.0","phantomjs-prebuilt":"2.1.14",rollup:"^0.50.0","rollup-plugin-commonjs":"^8.2.4","rollup-plugin-json":"^2.3.0","rollup-plugin-node-builtins":"^2.1.2","rollup-plugin-node-resolve":"^3.0.0","rollup-plugin-virtual":"^1.0.1",sinon:"1.17.7",soap:"0.18.0","uglify-js":"^3.1.5",webpack:"^3.8.1","whatwg-fetch":"2.0.2"},jsdoc2md={separators:!0,"module-index-format":"grouped","param-list-format":"table","property-list-format":"table"},jshintConfig={curly:!1,expr:!0,indent:4,latedef:!0},author={name:"RingCentral, Inc.",email:"devsupport@ringcentral.com"},contributors=[{name:"Kirill Konshin"}],repository={type:"git",url:"git://github.com/ringcentral/ringcentral-js.git"},bugs={url:"https://github.com/ringcentral/ringcentral-js/issues"},homepage="https://github.com/ringcentral/ringcentral-js",engines={node:">=0.10.36"},_package={name:"ringcentral",version:"3.1.3",scripts:scripts,dependencies:dependencies,devDependencies:devDependencies,jsdoc2md:jsdoc2md,jshintConfig:jshintConfig,preferGlobal:!1,main:"./src/SDK.js",author:author,contributors:contributors,repository:repository,bugs:bugs,homepage:homepage,engines:engines,license:"MIT",private:!1},_package$1=Object.freeze({name:"ringcentral",version:"3.1.3",scripts:scripts,dependencies:dependencies,devDependencies:devDependencies,jsdoc2md:jsdoc2md,jshintConfig:jshintConfig,preferGlobal:!1,main:"./src/SDK.js",author:author,contributors:contributors,repository:repository,bugs:bugs,homepage:homepage,engines:engines,license:"MIT",default:_package}),Constants={version:(_package$1&&_package||_package$1).version,authResponseProperty:"RCAuthorizationResponse"},EventEmitter$3=require$$0.EventEmitter;Platform._urlPrefix="/restapi",Platform._apiVersion="v1.0",Platform._tokenEndpoint="/restapi/oauth/token",Platform._revokeEndpoint="/restapi/oauth/revoke",Platform._authorizeEndpoint="/restapi/oauth/authorize",Platform._cacheId="platform",Platform.prototype=Object.create(EventEmitter$3.prototype),Platform.prototype.delay=function(timeout){return new this._externals.Promise(function(resolve,reject){setTimeout(function(){resolve(null)},timeout)})},Platform.prototype.auth=function(){return this._auth},Platform.prototype.client=function(){return this._client},Platform.prototype.createUrl=function(path,options){path=path||"",options=options||{};var builtUrl="",hasHttp=-1!=path.indexOf("http://")||-1!=path.indexOf("https://");return options.addServer&&!hasHttp&&(builtUrl+=this._server),-1!=path.indexOf(Platform._urlPrefix)||hasHttp||(builtUrl+=Platform._urlPrefix+"/"+Platform._apiVersion),builtUrl+=path,(options.addMethod||options.addToken)&&(builtUrl+=path.indexOf("?")>-1?"&":"?"),options.addMethod&&(builtUrl+="_method="+options.addMethod),options.addToken&&(builtUrl+=(options.addMethod?"&":"")+"access_token="+this._auth.accessToken()),builtUrl},Platform.prototype.loginUrl=function(options){return options=options||{},this.createUrl(Platform._authorizeEndpoint+"?"+qs$2.stringify({response_type:options.implicit?"token":"code",redirect_uri:options.redirectUri||this._redirectUri,client_id:this._appKey,state:options.state||"",brand_id:options.brandId||"",display:options.display||"",prompt:options.prompt||""}),{addServer:!0})},Platform.prototype.parseLoginRedirect=function(url){function getParts(url,separator){return url.split(separator).reverse()[0]}var response=0===url.indexOf("#")&&getParts(url,"#")||0===url.indexOf("?")&&getParts(url,"?")||null;if(!response)throw new Error("Unable to parse response");var queryString=qs$2.parse(response);if(!queryString)throw new Error("Unable to parse response");var error=queryString.error_description||queryString.error;if(error){var e=new Error(error);throw e.error=queryString.error,e}return queryString},Platform.prototype.loginWindow=function(options){return new this._externals.Promise(function(resolve,reject){if("undefined"==typeof window)throw new Error("This method can be used only in browser");if(!options.url)throw new Error("Missing mandatory URL parameter");(options=options||{}).width=options.width||400,options.height=options.height||600,options.origin=options.origin||window.location.origin,options.property=options.property||Constants.authResponseProperty,options.target=options.target||"_blank";var dualScreenLeft=void 0!==window.screenLeft?window.screenLeft:screen.left,dualScreenTop=void 0!==window.screenTop?window.screenTop:screen.top,width=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,height=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,left=width/2-options.width/2+dualScreenLeft,top=height/2-options.height/2+dualScreenTop,win=window.open(options.url,"_blank","_blank"==options.target?"scrollbars=yes, status=yes, width="+options.width+", height="+options.height+", left="+left+", top="+top:"");if(!win)throw new Error("Could not open login window. Please allow popups for this site");win.focus&&win.focus();var eventMethod=window.addEventListener?"addEventListener":"attachEvent",eventRemoveMethod="addEventListener"==eventMethod?"removeEventListener":"detachEvent",messageEvent="addEventListener"==eventMethod?"message":"onmessage",eventListener=function(e){try{if(e.origin!=options.origin)return;if(!e.data||!e.data[options.property])return;win.close(),window[eventRemoveMethod](messageEvent,eventListener);var loginOptions=this.parseLoginRedirect(e.data[options.property]);if(!loginOptions.code&&!loginOptions.access_token)throw new Error("No authorization code or token");resolve(loginOptions)}catch(e){reject(e)}}.bind(this);window[eventMethod](messageEvent,eventListener,!1)}.bind(this))},Platform.prototype.loggedIn=function(){return this.ensureLoggedIn().then(function(){return!0}).catch(function(){return!1})},Platform.prototype.login=function(options){return new this._externals.Promise(function(resolve){options=options||{},this.emit(this.events.beforeLogin);var body={};if(options.access_token)return resolve(options);options.code?options.code&&(body.grant_type="authorization_code",body.code=options.code,body.redirect_uri=options.redirectUri||this._redirectUri):(body.grant_type="password",body.username=options.username,body.password=options.password,body.extension=options.extension||""),options.endpointId&&(body.endpoint_id=options.endpointId),options.accessTokenTtl&&(body.accessTokenTtl=options.accessTokenTtl),options.refreshTokenTtl&&(body.refreshTokenTtl=options.refreshTokenTtl),resolve(this._tokenRequest(Platform._tokenEndpoint,body))}.bind(this)).then(function(res){var apiResponse=res.json?res:null,json=apiResponse&&apiResponse.json()||res;return this._auth.setData(json),this.emit(this.events.loginSuccess,apiResponse),apiResponse}.bind(this)).catch(function(e){throw this._clearCacheOnRefreshError&&this._cache.clean(),this.emit(this.events.loginError,e),e}.bind(this))},Platform.prototype._refresh=function(){return this.delay(this._refreshDelayMs).then(function(){if(this.emit(this.events.beforeRefresh),!this._auth.refreshToken())throw new Error("Refresh token is missing");if(!this._auth.refreshTokenValid())throw new Error("Refresh token has expired");return this._tokenRequest(Platform._tokenEndpoint,{grant_type:"refresh_token",refresh_token:this._auth.refreshToken(),access_token_ttl:this._auth.data().expires_in+1,refresh_token_ttl:this._auth.data().refresh_token_expires_in+1})}.bind(this)).then(function(res){var json=res.json();if(!json.access_token)throw this._client.makeError(new Error("Malformed OAuth response"),res);return this._auth.setData(json),this.emit(this.events.refreshSuccess,res),res}.bind(this)).catch(function(e){throw e=this._client.makeError(e),this._clearCacheOnRefreshError&&this._cache.clean(),this.emit(this.events.refreshError,e),e}.bind(this))},Platform.prototype.refresh=function(){return this._refreshPromise||(this._refreshPromise=this._refresh().then(function(res){return this._refreshPromise=null,res}.bind(this)).catch(function(e){throw this._refreshPromise=null,e}.bind(this))),this._refreshPromise},Platform.prototype.logout=function(){return new this._externals.Promise(function(resolve){this.emit(this.events.beforeLogout),resolve(this._tokenRequest(Platform._revokeEndpoint,{token:this._auth.accessToken()}))}.bind(this)).then(function(res){return this._cache.clean(),this.emit(this.events.logoutSuccess,res),res}.bind(this)).catch(function(e){throw this.emit(this.events.logoutError,e),e}.bind(this))},Platform.prototype.inflateRequest=function(request,options){return(options=options||{}).skipAuthCheck?this._externals.Promise.resolve(request):this.ensureLoggedIn().then(function(){return request.headers.set("X-User-Agent",this._userAgent),request.headers.set("Client-Id",this._appKey),request.headers.set("Authorization",this._authHeader()),request}.bind(this))},Platform.prototype.sendRequest=function(request,options){return this.inflateRequest(request,options).then(function(request){return options=options||{},this._client.sendRequest(request)}.bind(this)).catch(function(e){if(!e.apiResponse||!e.apiResponse.response()||options.retry)throw e;var response=e.apiResponse.response(),status=response.status;if(status!=ApiResponse_1._unauthorizedStatus&&status!=ApiResponse_1._rateLimitStatus)throw e;options.retry=!0;var retryAfter=0;if(status==ApiResponse_1._unauthorizedStatus&&this._auth.cancelAccessToken(),status==ApiResponse_1._rateLimitStatus){var defaultRetryAfter=options.handleRateLimit&&"boolean"!=typeof options.handleRateLimit?options.handleRateLimit:60;if(retryAfter=1e3*parseFloat(response.headers.get("retry-after")||defaultRetryAfter),e.retryAfter=retryAfter,this.emit(this.events.rateLimitError,e),!options.handleRateLimit)throw e}return this.delay(retryAfter).then(function(){return this.sendRequest(request,options)}.bind(this))}.bind(this))},Platform.prototype.send=function(options){return options=options||{},options.url=this.createUrl(options.url,{addServer:!0}),this.sendRequest(this._client.createRequest(options),options)},Platform.prototype.get=function(url,query,options){return this.send(objectAssign({},{method:"GET",url:url,query:query},options))},Platform.prototype.post=function(url,body,query,options){return this.send(objectAssign({},{method:"POST",url:url,query:query,body:body},options))},Platform.prototype.put=function(url,body,query,options){return this.send(objectAssign({},{method:"PUT",url:url,query:query,body:body},options))},Platform.prototype.delete=function(url,query,options){return this.send(objectAssign({},{method:"DELETE",url:url,query:query},options))},Platform.prototype.ensureLoggedIn=function(){return this._isAccessTokenValid()?this._externals.Promise.resolve():this.refresh()},Platform.prototype._tokenRequest=function(path,body){return this.send({url:path,skipAuthCheck:!0,body:body,method:"POST",headers:{Authorization:"Basic "+this._apiKey(),"Content-Type":ApiResponse_1._urlencodedContentType}})},Platform.prototype._isAccessTokenValid=function(){return this._auth.accessTokenValid()},Platform.prototype._apiKey=function(){var apiKey=this._appKey+":"+this._appSecret;return"function"==typeof btoa?btoa(apiKey):new Buffer(apiKey).toString("base64")},Platform.prototype._authHeader=function(){var token=this._auth.accessToken();return this._auth.tokenType()+(token?" "+token:"")};var Platform_1=Platform,EventEmitter$4=require$$0.EventEmitter,ISO_REG_EXP=/(\+[\d]{2}):?([\d]{2})?$/;(Subscription.prototype=Object.create(EventEmitter$4.prototype)).subscribed=function(){var subscription=this.subscription();return!!(subscription.id&&subscription.deliveryMode&&subscription.deliveryMode.subscriberKey&&subscription.deliveryMode.address)},Subscription.prototype.alive=function(){return this.subscribed()&&Date.now()<this.expirationTime()},Subscription.prototype.expired=function(){return!this.subscribed()||(!this.subscribed()||Date.now()>parseISOString(this.subscription().expirationTime))},Subscription.prototype.expirationTime=function(){return parseISOString(this.subscription().expirationTime)-this._renewHandicapMs},Subscription.prototype.setSubscription=function(subscription){return subscription=subscription||{},this._clearTimeout(),this._setSubscription(subscription),this._subscribeAtPubnub(),this._setTimeout(),this},Subscription.prototype.subscription=function(){return this._subscription||{}},Subscription.prototype.register=function(){return this.alive()?this.renew():this.subscribe()},Subscription.prototype.eventFilters=function(){return this.subscription().eventFilters||[]},Subscription.prototype.addEventFilters=function(events){return this.setEventFilters(this.eventFilters().concat(events)),this},Subscription.prototype.setEventFilters=function(events){var subscription=this.subscription();return subscription.eventFilters=events,this._setSubscription(subscription),this},Subscription.prototype.subscribe=function(){return new this._externals.Promise(function(resolve){if(this._clearTimeout(),!this.eventFilters().length)throw new Error("Events are undefined");resolve(this._platform.post("/subscription",{eventFilters:this._getFullEventFilters(),deliveryMode:{transportType:"PubNub"}}))}.bind(this)).then(function(response){var json=response.json();return this.setSubscription(json).emit(this.events.subscribeSuccess,response),response}.bind(this)).catch(function(e){throw e=this._platform.client().makeError(e),this.reset().emit(this.events.subscribeError,e),e}.bind(this))},Subscription.prototype.renew=function(){return new this._externals.Promise(function(resolve){if(this._clearTimeout(),!this.subscribed())throw new Error("No subscription");if(!this.eventFilters().length)throw new Error("Events are undefined");resolve(this._platform.put("/subscription/"+this.subscription().id,{eventFilters:this._getFullEventFilters()}))}.bind(this)).then(function(response){var json=response.json();return this.setSubscription(json).emit(this.events.renewSuccess,response),response}.bind(this)).catch(function(e){throw e=this._platform.client().makeError(e),this.reset().emit(this.events.renewError,e),e}.bind(this))},Subscription.prototype.remove=function(){return new this._externals.Promise(function(resolve){if(!this.subscribed())throw new Error("No subscription");resolve(this._platform.delete("/subscription/"+this.subscription().id))}.bind(this)).then(function(response){return this.reset().emit(this.events.removeSuccess,response),response}.bind(this)).catch(function(e){throw e=this._platform.client().makeError(e),this.emit(this.events.removeError,e),e}.bind(this))},Subscription.prototype.resubscribe=function(){var filters=this.eventFilters();return this.reset().setEventFilters(filters).subscribe()},Subscription.prototype.reset=function(){return this._clearTimeout(),this._unsubscribeAtPubnub(),this._setSubscription(null),this},Subscription.prototype._setSubscription=function(subscription){this._subscription=subscription},Subscription.prototype._getFullEventFilters=function(){return this.eventFilters().map(function(event){return this._platform.createUrl(event)}.bind(this))},Subscription.prototype._setTimeout=function(){if(this._clearTimeout(),!this.alive())throw new Error("Subscription is not alive");return this._timeout=setInterval(function(){this.alive()||(this._clearTimeout(),new this._externals.Promise(function(resolve){resolve(this.expired()?this.subscribe():this.renew())}.bind(this)).then(function(res){this.emit(this.events.automaticRenewSuccess,res)}.bind(this)).catch(function(e){this.emit(this.events.automaticRenewError,e)}.bind(this)))}.bind(this),this._pollInterval),this},Subscription.prototype._clearTimeout=function(){return clearInterval(this._timeout),this},Subscription.prototype._decrypt=function(message){if(!this.subscribed())throw new Error("No subscription");return this.subscription().deliveryMode.encryptionKey&&(message=this._pubnub.decrypt(message,this.subscription().deliveryMode.encryptionKey,{encryptKey:!1,keyEncoding:"base64",keyLength:128,mode:"ecb"})),message},Subscription.prototype._notify=function(message){return this.emit(this.events.notification,this._decrypt(message)),this},Subscription.prototype._subscribeAtPubnub=function(){if(!this.alive())throw new Error("Subscription is not alive");var deliveryMode=this.subscription().deliveryMode;if(this._pubnub){if(this._pubnubLastChannel===deliveryMode.address)return this;this._pubnubLastSubscribeKey&&this._pubnubLastSubscribeKey!==deliveryMode.subscriberKey?this._unsubscribeAtPubnub():this._pubnubLastChannel&&this._pubnub.unsubscribeAll()}if(!this._pubnub){this._pubnubLastSubscribeKey=deliveryMode.subscriberKey;var PubNub=this._externals.PubNub;this._pubnub=new PubNub({ssl:!0,restore:!0,subscribeKey:deliveryMode.subscriberKey}),this._pubnub.addListener({status:function(statusEvent){},message:function(m){this._notify(m.message)}.bind(this)})}return this._pubnubLastChannel=deliveryMode.address,this._pubnub.subscribe({channels:[deliveryMode.address]}),this},Subscription.prototype._unsubscribeAtPubnub=function(){return this.subscribed()&&this._pubnub?(this._pubnub.removeAllListeners(),this._pubnub.destroy(),this._pubnubLastSubscribeKey=null,this._pubnubLastChannel=null,this._pubnub=null,this):this};var Subscription_1=Subscription;(CachedSubscription.prototype=Object.create(Subscription_1.prototype)).subscription=function(){return this._cache.getItem(this._cacheKey)||{}},CachedSubscription.prototype._setSubscription=function(subscription){return this._cache.setItem(this._cacheKey,subscription)},CachedSubscription.prototype.restore=function(events){return this.eventFilters().length||this.setEventFilters(events),this};var CachedSubscription_1=CachedSubscription;return SDK.version=Constants.version,SDK.server={sandbox:"https://platform.devtest.ringcentral.com",production:"https://platform.ringcentral.com"},SDK.prototype.platform=function(){return this._platform},SDK.prototype.cache=function(){return this._cache},SDK.prototype.createSubscription=function(options){return new Subscription_1(objectAssign({},options,{externals:this._externals,platform:this._platform}))},SDK.prototype.createCachedSubscription=function(options){return options="string"==typeof arguments[0]?{cacheKey:arguments[0].toString()}:options||{},new CachedSubscription_1(objectAssign({},options,{externals:this._externals,platform:this._platform,cache:this._cache}))},SDK.handleLoginRedirect=function(origin,win){var response=(win=win||window).location.hash?win.location.hash:win.location.search,msg={};msg[Constants.authResponseProperty]=response,win.opener.postMessage(msg,origin||win.location.origin)},SDK});